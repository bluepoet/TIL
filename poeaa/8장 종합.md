# 8장 종합

- 각자의 설계에 대해서는 저자보다 본인이 더 많이 알고 있다.
- 저자의 조언을 각자의 사고를 촉진하는 재료로 활용하자
- 지속적 통합(CI), 테스트주도개발(TDD), 리팩토링(Refactoring) 세가지 기술기법은 진지하게 고려해봐라

## 도메인 계층으로 시작하기

- 도메인 논리 선택 : 트랜잭션 스크립트, 테이블 모듈, 도메인 모델
- 도메인 논리 선택 기준 : 도메인 논리의 복잡성, 데이터베이스 연결의 난이도
- 트랜잭션 스크립트
 - 절차적 모델과 잘 맞고, 시스템 트랜잭션 캡슐화 용이, RDB기반 구축 쉽다
 - 복잡한 비지니스 논리 대처 어렵다
 - 중복코드가 늘어난다
- 도메인 모델
 - 배우기 어렵다.
 - RDB와의 Impedance Mismatch(객체 <-> 관계형 모델)
- 테이블 모듈
 - 레코드 집합과 관련된 툴이 많은 .Net과 같은 환경에 용이
 - 도메인 논리의 팩터링도 합리적인 수준에서 가능

## 데이터 원본 계층

##### 트랜잭션 스크립트의 데이터 원본

- 데이터베이스 분리 : 행 데이터 게이트웨이, 테이블 데이터 게이트웨이
- 별도의 O/R 맵핑 필요없음.
- 단일 트랜잭션 사용. 예외시 낙관적 오프라인 잠금이 최적의 선택

##### 테이블 모듈의 데이터 원본

- 선택이유 : 좋은 레코드 집합 프레임워크가 있기 때문
- 테이블 데이터 게이트웨이와 잘 맞음

##### 도메인 모델의 데이터 원본

- 도메인 모델이 간단할 시, 활성 레코드를 선택하는게 합리적
- 도메인 모델이 복잡하다면, 다른 모든 계층으로부터 독립적으로 운영하기 위해 데이터 매퍼 사용 고려
- 데이터 매퍼 선택시, 동시성 제어의 구심적 역할을 하는 **작업 단위** 적극 추천!

## 프레젠테이션 계층

- 리치 클라이언트 vs HTML 브라우저 인터페이스
- 어플리케이션 기본 구조 : 모델/뷰/컨트롤러
- 비쥬얼 스튜디오 : 페이지 컨트롤러 + 템플릿 뷰
- 자바 : ~~스트러츠~~ **스프링!** + 템플릿 뷰
- 뷰 : 템플릿 뷰, 변환 뷰, 2단계 뷰
- 하위계층과 통신은 가능한 모든 항목을 한 프로세스에서 실행하는 방식 선호
 - 불가능할 시, 도메인 계층을 원격 파사드로 래핑하고 DTO로 웹서버와 통신

## 몇 가지 기술 관련 조언

##### 자바의 J2EE

- J2EE를 위한 설계 대안 : 사용할 패턴에 따라 달라지고, 도메인 논리에 따라 더 분화됨
- 행 데이터 게이트웨이나 테이블 데이터 게이트웨이 위에 트랜잭션 스크립트로 POJO 사용
- 프리젠테이션과 도메인 간의 원격호출 피함
- POJO 도메인 모델 사용시, O/R 매핑툴 활용 혹은 직접 만든 데이터 매퍼 사용

##### .NET

- 테이블 모듈이 주된 패턴

##### 저장 프로시저

- 저장 프로시저 사용시 특정 데이터베이스로 공급업체로 고착화되는 문제점! -> 강결합
- 성능이 크게 향상되는 경우 비지니스 논리를 이식하는 경우 있음

##### 웹 서비스

## 다른 계층화 체계
- 브라운 모델
  - 프레젠테이션 vs 프레젠테이션
  - 컨트롤러 중재자 vs 프레젠테이션(어플리케이션 컨트롤러)
  - 도메인 vs 도메인
  - 데이터 매핑 vs 데이터 원본(데이터 매퍼)
  - 데이터 원본 vs 데이터 원본
- 코어 J2EE 계층
  - 클라이언트 vs 클라이언트에서 실행되는 프리젠테이션
  - 프레젠테이션 vs 서버에서 실행되는 프레젠테이션
  - 비지니스 vs 도메인
  - 통합 vs 데이터 원본
  - 리소스 vs 데이터 원본과 통신하는 외부 리소스
- 마이크로소프트 DNA 계층
  - 프레젠테이션 vs 프레젠테이션
  - 비지니스 vs 도메인
  - 데이터 접근 vs 데이터 원본
- 마리네스쿠 계층
  - 프레젠테이션 vs 프레젠테이션
  - 애플리케이션 vs 프레젠테이션(어플리케이션 컨트롤러)
  - 서비스 vs 도메인(서비스 계층)
  - 도메인 vs 도메인(도메인 모델)
  - 지속성 vs 데이터 원본
- 도메인 계층에서 서비스 계층을 분리하는 아이디어는 순수 도메인 논리에서 워크프로 논리를 분리하는 아이디어에서 바탕을 둠
- 닐슨의 계층
  - 소비자 vs 프레젠테이션
  - 소비자 도우미  vs 프레젠테이션(어플리케이션 컨트롤러)
  - 애플리케이션 vs 도메인(서비스 계층)
  - 도메인 vs 도메인(도메인 모델)
  - 지속성 접근 vs 데이터 원본
  - 공용 저장 프로시저 vs 데이터 원본(도메인 일부를 포함할 수 있음)
  - 전용 저장 프로시저 vs 데이터 원본(도메인 일부를 포함할 수 있음)